2025-09-18 11:58:43,414 - mcp-http-server - INFO - ğŸš€ Starting MCP HTTP Server for PG1 on port 8003
2025-09-18 11:58:43,414 - mcp-postgres-backup - INFO - ğŸ”§ MCP PostgreSQL Backup Server initialized for PG1
2025-09-18 11:58:43,415 - mcp-http-server - INFO - ğŸ”§ MCP HTTP Server initialized for PG1 on port 8003
2025-09-18 11:58:43,415 - mcp-http-server - INFO - ğŸŒ Available routes: ['/openapi.json', '/docs', '/docs/oauth2-redirect', '/redoc', '/', '/tools', '/invoke', '/health']
INFO:     Started server process [14377]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8003 (Press CTRL+C to quit)
2025-09-18 11:58:53,368 - mcp-postgres-backup - INFO - ğŸ”§ Direct tool call: health with arguments: {}
2025-09-18 11:58:53,431 - mcp-postgres-backup - INFO - âœ… Health check completed for PG1
INFO:     127.0.0.1:58992 - "GET /health HTTP/1.1" 200 OK
2025-09-18 11:59:27,595 - mcp-http-server - INFO - ğŸ”§ Invoking tool 'restore_database' with args: {'db_name': 'inventory_db', 'backup_id': 'inventory_db_wal_20250913_202646'}
2025-09-18 11:59:27,595 - mcp-postgres-backup - INFO - ğŸ”§ Direct tool call: restore_database with arguments: {'db_name': 'inventory_db', 'backup_id': 'inventory_db_wal_20250913_202646'}
2025-09-18 11:59:27,596 - mcp-postgres-backup - INFO - ğŸ”¥ STARTING REAL DATABASE RESTORE: inventory_db_restore_20250918_115927
2025-09-18 11:59:27,596 - mcp-postgres-backup - INFO - ğŸ“Š Database: inventory_db
2025-09-18 11:59:27,596 - mcp-postgres-backup - INFO - ğŸ·ï¸  Backup ID: inventory_db_wal_20250913_202646
2025-09-18 11:59:27,596 - mcp-postgres-backup - INFO - ğŸ“¦ Backup found: /Users/aarthiprashanth/workspace/github.ibm.com/sp-lakehouse-backup/backups/mcp1/wal_incremental/inventory_db_wal_20250913_202646 (type: incremental)
2025-09-18 11:59:27,596 - mcp-postgres-backup - INFO - ğŸ’¾ Step 1: Creating rollback backup...
2025-09-18 11:59:27,596 - mcp-postgres-backup - INFO - ğŸ’¾ Creating rollback backup for inventory_db
2025-09-18 11:59:27,734 - mcp-postgres-backup - INFO - âœ… Rollback backup created: /Users/aarthiprashanth/workspace/github.ibm.com/sp-lakehouse-backup/backups/mcp1/rollback_backups/inventory_db_inventory_db_restore_20250918_115927_rollback.sql
2025-09-18 11:59:27,735 - mcp-postgres-backup - INFO - ğŸ”„ Step 2: Executing REAL database restore...
2025-09-18 11:59:27,735 - mcp-postgres-backup - INFO - ğŸ”„ Executing REAL restore for inventory_db from /Users/aarthiprashanth/workspace/github.ibm.com/sp-lakehouse-backup/backups/mcp1/wal_incremental/inventory_db_wal_20250913_202646
2025-09-18 11:59:27,735 - mcp-postgres-backup - INFO - ğŸ”„ Incremental backup restore for inventory_db
2025-09-18 11:59:27,735 - mcp-postgres-backup - INFO - ğŸ“¦ Found base backup: inventory_db_base_20250913_150713
2025-09-18 11:59:27,744 - true_wal_incremental_backup - INFO - Loading WAL backup registry for MCP1
2025-09-18 11:59:27,773 - true_wal_incremental_backup - INFO - Loaded 99 WAL backup records
2025-09-18 11:59:27,774 - true_wal_incremental_backup - INFO - ğŸ”§ True WAL incremental backup server initialized for MCP1
2025-09-18 11:59:27,775 - true_wal_incremental_backup - INFO - ğŸ”¥ EXECUTING TRUE WAL RESTORE: inventory_db_restore_20250918_115927
2025-09-18 11:59:27,775 - true_wal_incremental_backup - INFO - ğŸ›‘ Step 1: Stopping PostgreSQL...
2025-09-18 11:59:27,775 - true_wal_incremental_backup - INFO - ğŸ›‘ Terminating connections to database inventory_db
2025-09-18 11:59:27,820 - true_wal_incremental_backup - INFO - âœ… Terminated connections to inventory_db
2025-09-18 11:59:27,820 - true_wal_incremental_backup - INFO - ğŸ’¾ Step 2: Backing up current data directory...
2025-09-18 11:59:27,820 - true_wal_incremental_backup - INFO - ğŸ’¾ Creating backup dump of current inventory_db database
2025-09-18 11:59:27,897 - true_wal_incremental_backup - INFO - âœ… Current database backed up to: /Users/aarthiprashanth/workspace/github.ibm.com/sp-lakehouse-backup/backups/mcp1/rollback_backups/inventory_db_inventory_db_restore_20250918_115927.sql
2025-09-18 11:59:27,897 - true_wal_incremental_backup - INFO - ğŸ“¦ Step 3: Restoring base backup...
2025-09-18 11:59:27,897 - true_wal_incremental_backup - INFO - ğŸ“¦ Restoring base backup inventory_db_base_20250913_150713
2025-09-18 11:59:27,897 - true_wal_incremental_backup - INFO - ğŸ“ Restoring from base backup tar: /Users/aarthiprashanth/workspace/github.ibm.com/sp-lakehouse-backup/backups/mcp1/basebackups/inventory_db_base_20250913_150713/base.tar.gz
2025-09-18 11:59:27,898 - true_wal_incremental_backup - INFO - ğŸ”„ Performing REAL database restoration from /Users/aarthiprashanth/workspace/github.ibm.com/sp-lakehouse-backup/backups/mcp1/basebackups/inventory_db_base_20250913_150713/base.tar.gz
2025-09-18 11:59:27,899 - true_wal_incremental_backup - INFO - ğŸ“¦ Extracting base backup archive...
2025-09-18 11:59:28,435 - true_wal_incremental_backup - INFO - ğŸ”§ Using practical restore approach for base backup
2025-09-18 11:59:28,435 - true_wal_incremental_backup - INFO - ğŸ”§ Performing practical restore for inventory_db to backup inventory_db_base_20250913_150713
2025-09-18 11:59:28,435 - true_wal_incremental_backup - INFO - ğŸ“… Target restore time: 2025-09-13T15:07:13.545865
2025-09-18 11:59:28,435 - true_wal_incremental_backup - INFO - ğŸ—‘ï¸ Dropping current database...
2025-09-18 11:59:28,513 - true_wal_incremental_backup - INFO - âœ… Database dropped successfully
2025-09-18 11:59:28,513 - true_wal_incremental_backup - INFO - ğŸ”¨ Recreating database...
2025-09-18 11:59:28,596 - true_wal_incremental_backup - INFO - âœ… Database recreated successfully
2025-09-18 11:59:28,596 - true_wal_incremental_backup - INFO - ğŸ“Š Restoring database schema and data...
2025-09-18 11:59:28,722 - true_wal_incremental_backup - INFO - âœ… Database schema and initial data restored successfully
2025-09-18 11:59:28,723 - true_wal_incremental_backup - INFO - ğŸ‰ REAL DATABASE RESTORE COMPLETED for inventory_db
2025-09-18 11:59:28,723 - true_wal_incremental_backup - INFO - ğŸ’¡ Database has been reset to initial state (before any post-backup changes)
2025-09-18 11:59:28,869 - true_wal_incremental_backup - INFO - âš™ï¸ Step 4: Configuring WAL recovery...
2025-09-18 11:59:28,869 - true_wal_incremental_backup - INFO - âš™ï¸ Configuring WAL recovery for inventory_db
2025-09-18 11:59:28,869 - true_wal_incremental_backup - INFO - ğŸ“ Recovery configuration:
2025-09-18 11:59:28,869 - true_wal_incremental_backup - INFO -    Target LSN: 3/39000000
2025-09-18 11:59:28,869 - true_wal_incremental_backup - INFO -    WAL files to replay: 5
2025-09-18 11:59:28,869 - true_wal_incremental_backup - INFO -    First WAL: 000000190000000300000034.wal
2025-09-18 11:59:28,869 - true_wal_incremental_backup - INFO -    Last WAL: 000000190000000300000038.wal
2025-09-18 11:59:28,869 - true_wal_incremental_backup - INFO - âœ… WAL recovery configuration completed
2025-09-18 11:59:28,869 - true_wal_incremental_backup - INFO - ğŸ”„ Step 5: Starting PostgreSQL to perform WAL recovery...
2025-09-18 11:59:28,869 - true_wal_incremental_backup - INFO - ğŸ”„ Re-enabling connections to database inventory_db
2025-09-18 11:59:28,921 - true_wal_incremental_backup - INFO - âœ… Database inventory_db is accessible and ready
2025-09-18 11:59:28,921 - true_wal_incremental_backup - INFO - âœ… Step 6: Verifying restore completion...
2025-09-18 11:59:28,921 - true_wal_incremental_backup - INFO - âœ… Verifying restore completion for inventory_db
2025-09-18 11:59:28,921 - true_wal_incremental_backup - INFO - ğŸ” Checking LSN position matches target: 3/39000000
2025-09-18 11:59:28,921 - true_wal_incremental_backup - INFO - ğŸ” Verifying database accessibility...
2025-09-18 11:59:28,921 - true_wal_incremental_backup - INFO - ğŸ” Running data integrity checks...
2025-09-18 11:59:28,921 - true_wal_incremental_backup - INFO - âœ… Restore verification completed - database inventory_db restored to LSN 3/39000000
2025-09-18 11:59:28,921 - true_wal_incremental_backup - INFO - ğŸ‰ TRUE WAL RESTORE COMPLETED SUCCESSFULLY: inventory_db_restore_20250918_115927
2025-09-18 11:59:28,921 - mcp-postgres-backup - INFO - âœ… TRUE incremental restore completed for inventory_db
2025-09-18 11:59:28,921 - mcp-postgres-backup - INFO - ğŸ‰ REAL DATABASE RESTORE COMPLETED: inventory_db_restore_20250918_115927
INFO:     127.0.0.1:59032 - "POST /invoke HTTP/1.1" 200 OK
